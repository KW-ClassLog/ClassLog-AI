lecture_memories = {}

# í€´ì¦ˆ ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ êµ¬ì„± + ì´ì „ í€´ì¦ˆ ì €ìž¥ìš© í´ëž˜ìŠ¤
class QuizMemory:
    def __init__(self):
        self.previous_quizzes = []

    def add(self, quiz_text: str):
        self.previous_quizzes.append(quiz_text)

    def get_all(self):
        return self.previous_quizzes

    def get_prompt(self, document_text: str, audio_text: str):
        if self.previous_quizzes:
            history = "\n\n---\n\n".join(self.previous_quizzes)
            history_block = f"â€» ì´ì „ì— ìƒì„±ëœ í€´ì¦ˆëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ë™ì¼í•˜ê±°ë‚˜ ìœ ì‚¬í•œ ë¬¸ì œëŠ” ì ˆëŒ€ ì¤‘ë³µí•´ì„œ ìƒì„±í•˜ì§€ ë§ˆì„¸ìš”.\n\nì´ì „ í€´ì¦ˆ:\n{history}"
        else:
            history_block = ""
        
        base_intro = "ë‹¤ìŒì€ ê°•ì˜ ìžë£Œ"
        if audio_text.strip():
            base_intro += "ì™€ ì¼ë¶€ ê°•ì˜ ìŒì„± í…ìŠ¤íŠ¸ë¥¼ ì°¸ê³ í•˜ì—¬ ë§Œë“  ì½˜í…ì¸ ìž…ë‹ˆë‹¤.\nìŒì„± í…ìŠ¤íŠ¸ëŠ” ê°•ì˜ìžë£Œì—ì„œ ëˆ„ë½ëœ ë³´ì¡° ì„¤ëª…ì´ë¯€ë¡œ, í€´ì¦ˆ ìƒì„± ì‹œ ì°¸ê³  ì •ë„ë¡œë§Œ í™œìš©í•´ ì£¼ì„¸ìš”."
        else:
            base_intro += "ë¥¼ ì°¸ê³ í•˜ì—¬ ë§Œë“  ì½˜í…ì¸ ìž…ë‹ˆë‹¤."

        return f"""
    {base_intro}

    {history_block}

    ë‹¤ìŒ ì¡°ê±´ì— ë§žëŠ” ìƒˆë¡œìš´ í€´ì¦ˆë¥¼ ìƒì„±í•´ ì£¼ì„¸ìš”:

    - ê°ê´€ì‹ 2ë¬¸ì œ (ë³´ê¸° 4ê°œ, ì •ë‹µ í¬í•¨)
    - ë‹¨ë‹µí˜• ì£¼ê´€ì‹ 1ë¬¸ì œ (ì •ë‹µ í¬í•¨)
    - ì°¸/ê±°ì§“ ë¬¸ì œ 1ë¬¸ì œ (ì •ë‹µ í¬í•¨)
    - ëª¨ë“  ë¬¸í•­ì€ ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œ ìž‘ì„±í•´ ì£¼ì„¸ìš”.
    â€» ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ëª¨ë“  í•­ëª©ì€ ìˆœìˆ˜ í…ìŠ¤íŠ¸ë¡œ ìž‘ì„±í•´ì£¼ì„¸ìš”.

    ë¬¸ìž¥ ìŠ¤íƒ€ì¼ ì§€ì¹¨:
    - ê°ê´€ì‹/ì£¼ê´€ì‹ ë¬¸í•­ì€ â€œ~ì„ ê³ ë¥´ì„¸ìš”â€, â€œ~ì€ ë¬´ì—‡ì¸ê°€ìš”?â€ í˜•íƒœì˜ ì¡´ëŒ“ë§ë¡œ ìž‘ì„±
    - ì°¸/ê±°ì§“ ë¬¸í•­ì€ â€œ~ì´ë‹¤â€, â€œ~í•˜ì§€ ì•ŠëŠ”ë‹¤â€ í˜•íƒœì˜ í‰ì„œë¬¸ìœ¼ë¡œ ìž‘ì„±

    ì¶œë ¥ í˜•ì‹ ì§€ì¹¨ (ê¼­ ì§€ì¼œì£¼ì„¸ìš”):
    [ë¬¸í•­ ìœ í˜•: ê°ê´€ì‹]
    ë¬¸ì œ: ë°”ë‚˜ë‚˜ê°€ ê³¼ì¼ì´ ë§žëŠ” ì´ìœ ë¥¼ ê³ ë¥´ì„¸ìš”.
    ë³´ê¸°:
    1. ë³´ê¸°ë‚´ìš©1
    2. ë³´ê¸°ë‚´ìš©2
    3. ë³´ê¸°ë‚´ìš©3
    4. ë³´ê¸°ë‚´ìš©4
    ì •ë‹µ: 1. ë³´ê¸°ë‚´ìš©1

    [ë¬¸í•­ ìœ í˜•: ë‹¨ë‹µí˜•]
    ë¬¸ì œ: ë°”ë‚˜ë‚˜ëŠ” ë¬´ìŠ¨ ìƒ‰ì¸ê°€ìš”?
    ì •ë‹µ: ë…¸ëž€ìƒ‰


    [ë¬¸í•­ ìœ í˜•: ì°¸/ê±°ì§“]
    ë¬¸ì œ: ë°”ë‚˜ë‚˜ëŠ” ì˜ì–´ë¡œ bananaì´ë‹¤.
    ì •ë‹µ: O ë˜ëŠ” X

    ðŸ“˜ ê°•ì˜ìžë£Œ:
    {document_text}

    ðŸŽ§ ìŒì„± í…ìŠ¤íŠ¸ (ë³´ì¡° ì°¸ê³ ìš©):
    {audio_text}
    """

# ê°•ì˜ë³„ ë©”ëª¨ë¦¬ ì €ìž¥ì†Œ ë¶„ë¦¬
def get_lecture_memory(lecture_id: str) -> QuizMemory:
    if lecture_id not in lecture_memories:
        lecture_memories[lecture_id] = QuizMemory()
    return lecture_memories[lecture_id]